<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Cache Control Meta Tags for Mobile Cache Busting -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <!-- Additional Mobile-Specific Cache Control -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- Force refresh on mobile browsers -->
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    
    <title>DMTribut - EFTO Game</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    
    <!-- Preload critical background image with high priority -->
    <link rel="preload" href="assets/background.jpg" as="image" fetchpriority="high">
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="styles/base.css">
    <link rel="stylesheet" href="styles/ui-components.css">
    <link rel="stylesheet" href="styles/settings.css">
    <link rel="stylesheet" href="styles/notifications.css">
    <link rel="stylesheet" href="styles/game-panels.css">
    <link rel="stylesheet" href="styles/spell-bar.css">
    <link rel="stylesheet" href="styles/how-to-play.css">
    <link rel="stylesheet" href="styles/mobile.css">
  <!-- Built: 2025-06-30T11:09:51.498Z | Mode: Production -->
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    
    <!-- Canvas Border System -->
    <div class="canvas-border top"></div>
    <div class="canvas-border bottom"></div>
    <div class="canvas-border left"></div>
    <div class="canvas-border right"></div>
    
    <!-- Buff Tracker Container -->
    <div id="buffTracker" class="buff-tracker-container"></div>
    
    <!-- Spell Notifications Container -->
    <div id="spellNotifications" class="spell-notifications-container"></div>
    
    <!-- Canvas Overlay - prevents mouse interaction when game is not active -->
    <div id="canvasOverlay"></div>
    
    <!-- Game UI Elements -->
    <div id="gameUI" style="display: none;">
        
        
        
        <!-- Spell Bar -->
        <div id="spellBar">
            <div class="spell-slot" id="spell-dragon-cry">
                <div class="spell-icon">
                    <img src="assets/onyxia-buff.png" alt="Dragon Cry" class="spell-image">
                </div>
                <div class="spell-key">Q</div>
                <div class="spell-name">Dragon Cry</div>
                <div class="spell-timer" id="spell-dragon-cry-timer"></div>
                <div class="spell-cooldown-overlay" id="spell-dragon-cry-cooldown"></div>
            </div>
            
            <div class="spell-slot" id="spell-zandalari">
                <div class="spell-icon">
                    <img src="assets/zg-buff.png" alt="Zandalari" class="spell-image">
                </div>
                <div class="spell-key">W</div>
                <div class="spell-name">Zandalari</div>
                <div class="spell-timer" id="spell-zandalari-timer"></div>
                <div class="spell-cooldown-overlay" id="spell-zandalari-cooldown"></div>
            </div>
            
            <div class="spell-slot" id="spell-flask-of-titans">
                <div class="spell-icon">
                    <img src="assets/flask_of_titans.webp" alt="Flask of Titans" class="spell-image">
                </div>
                <div class="spell-key">E</div>
                <div class="spell-name">Flask of Titans</div>
                <div class="spell-timer" id="spell-flask-of-titans-timer"></div>
                <div class="spell-cooldown-overlay" id="spell-flask-of-titans-cooldown"></div>
            </div>
            
            <div class="spell-slot" id="spell-autoshot">
                <div class="spell-icon">
                    <img src="assets/autoshot.webp" alt="Autoshot" class="spell-image">
                </div>
                                        <div class="spell-key">A</div>
                <div class="spell-name">Autoshot</div>
                <div class="spell-timer" id="spell-autoshot-timer"></div>
                <div class="spell-cooldown-overlay" id="spell-autoshot-cooldown"></div>
            </div>
            
            <div class="spell-slot" id="spell-multishot">
                <div class="spell-icon">
                    <img src="assets/multishot.webp" alt="Multishot" class="spell-image">
                </div>
                <div class="spell-key">R</div>
                <div class="spell-name">Multishot</div>
                <div class="spell-timer" id="spell-multishot-timer"></div>
                <div class="spell-cooldown-overlay" id="spell-multishot-cooldown"></div>
            </div>
        </div>

    </div>
    
    <!-- Name Entry Screen -->
    <div id="nameEntry" style="display: none;">
                    <h2>Welcome to DMTribut!</h2>
        <p style="margin-bottom: 20px; color: #ccc;">Enter your name to start playing</p>
        <input type="text" id="playerNameInput" placeholder="Enter your name" maxlength="20" />
        <br>
        <button id="startGameBtn">Start Game</button>
        <button id="continueGameBtn" style="display: none;">Continue Game</button>
        <button id="restartGameBtn" style="display: none;">Restart Game</button>
        <button id="viewScoresBtn">High Scores</button>
        <button id="howToPlayBtn">How to Play</button>
        <button id="settingsBtn">Settings</button>
    </div>

    <!-- High Scores Screen -->
    <div id="highScoresScreen" class="screen" style="display: none;">
        <div class="screen-content">
            <h2>üèÜ High Scores</h2>
            <div id="highScoresList"></div>
            <div class="button-group">
                <button onclick="showMainMenu()" class="menu-btn">Back to Menu</button>
            </div>
        </div>
    </div>

    <!-- Settings Screen -->
    <div id="settingsScreen" class="screen" style="display: none;">
        <div class="screen-content settings-expanded">
            <h2>‚öôÔ∏è Game Settings</h2>
            
            <!-- Game Mode Settings Section -->
            <div class="settings-section">
                <h3>üéÆ Game Mode</h3>
                <p class="section-description">Choose your difficulty level - affects level progression and item spawn rates</p>
                
                <div class="setting-item radio-group">
                    <label class="radio-label">
                        <input type="radio" name="gameMode" value="easy" id="gameModeEasy">
                        <span class="radio-custom"></span>
                        <div class="radio-content">
                            <strong>üü¢ Easy Mode</strong>
                            <small>Slower level progression, more forgiving gameplay</small>
                        </div>
                    </label>
                </div>
                
                <div class="setting-item radio-group">
                    <label class="radio-label">
                        <input type="radio" name="gameMode" value="normal" id="gameModeNormal" checked>
                        <span class="radio-custom"></span>
                        <div class="radio-content">
                            <strong>üü° Normal Mode</strong>
                            <small>Standard difficulty and progression</small>
                        </div>
                    </label>
                </div>
                
                <div class="setting-item radio-group">
                    <label class="radio-label">
                        <input type="radio" name="gameMode" value="hard" id="gameModeHard">
                        <span class="radio-custom"></span>
                        <div class="radio-content">
                            <strong>üî¥ Hard Mode</strong>
                            <small>Faster progression, more challenging gameplay</small>
                        </div>
                    </label>
                </div>
            </div>
            
            <!-- Panel Appearance Settings Section -->
            <div class="settings-section">
                <h3>üìä Panel Appearance</h3>
                <p class="section-description">Control how information panels look and behave</p>
                
                <div class="setting-item">
                    <label for="playerPanelStyle">Player Panel Style:</label>
                    <select id="playerPanelStyle" class="setting-select">
                        <option value="auto">Auto (Screen Size Based)</option>
                        <option value="desktop">Desktop (Full Details)</option>
                        <option value="mobile">Mobile (Compact)</option>
                    </select>
                </div>
                
                <div class="setting-item">
                    <label for="dragonstalkerPanelStyle">Dragonstalker Panel Style:</label>
                    <select id="dragonstalkerPanelStyle" class="setting-select">
                        <option value="auto">Auto (Screen Size Based)</option>
                        <option value="desktop">Desktop (Full Details)</option>
                        <option value="mobile">Mobile (Compact)</option>
                    </select>
                </div>
                
                <div class="setting-item">
                    <label for="panelOpacity">Panel Transparency:</label>
                    <div class="volume-control">
                        <input type="range" id="panelOpacity" min="60" max="100" value="80" class="volume-slider">
                        <span id="panelOpacityValue" class="volume-display">80%</span>
                    </div>
                </div>
            </div>
            
            <!-- Audio Settings Section -->
            <div class="settings-section">
                <h3>üîä Audio Settings</h3>
                
                <div class="setting-item">
                    <label for="soundEffectsToggle">Play Sound Effects:</label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="soundEffectsToggle" checked>
                        <span class="toggle-slider"></span>
                    </div>
                </div>
                
                <div class="setting-item">
                    <label for="backgroundMusicToggle">Play Background Music:</label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="backgroundMusicToggle" checked>
                        <span class="toggle-slider"></span>
                    </div>
                </div>
                
                <div class="setting-item">
                    <label for="masterVolumeSlider">Master Volume:</label>
                    <div class="volume-control">
                        <input type="range" id="masterVolumeSlider" min="0" max="100" value="70" class="volume-slider">
                        <span id="masterVolumeValue" class="volume-display">70%</span>
                    </div>
                </div>
                
                <div class="setting-item">
                    <label for="musicVolumeSlider">Music Volume:</label>
                    <div class="volume-control">
                        <input type="range" id="musicVolumeSlider" min="0" max="100" value="50" class="volume-slider">
                        <span id="musicVolumeValue" class="volume-display">50%</span>
                    </div>
                </div>
                
                <div class="setting-item">
                    <label for="effectsVolumeSlider">Effects Volume:</label>
                    <div class="volume-control">
                        <input type="range" id="effectsVolumeSlider" min="0" max="100" value="80" class="volume-slider">
                        <span id="effectsVolumeValue" class="volume-display">80%</span>
                    </div>
                </div>
            </div>
            
            <div class="button-group">
                <button onclick="resetSettings()" class="menu-btn secondary">Reset to Defaults</button>
                <button id="settingsBackBtn" onclick="closeSettings()" class="menu-btn">Back</button>
            </div>
        </div>
    </div>

    <!-- How to Play Screen -->
    <div id="howToPlay" style="display: none;">
        <h2>üìñ How to Play üìñ</h2>
        <div id="howToPlayContent">
            <div class="guide-section">
                <h3>üéØ Objective</h3>
                <p>Collect all 10 Dragonstalker tier set pieces to win! Missing any piece means game over.</p>
            </div>

            <div class="guide-section">
                <h3>üéÆ Controls</h3>
                <p><strong>Desktop:</strong> Mouse to move your character</p>
                <p><strong>Mobile:</strong> Touch screen to move your character</p>
                <p><strong>ESC:</strong> Pause game</p>
                <p><strong>S:</strong> Open/close settings</p>
            </div>

            <div class="guide-section">
                <h3>‚ú® Beneficial Spells (Collect These!)</h3>
                <div class="spell-grid">
                    <div class="spell-item beneficial">
                        <strong>Power Word Shield</strong> - Grants temporary shield protection
                    </div>
                    <div class="spell-item beneficial">
                        <strong>Frost Nova</strong> - Freezes all projectiles (2 HP damage)
                    </div>
                    <div class="spell-item beneficial">
                        <strong>Speed Boost</strong> - Increases game speed for more points
                    </div>
                </div>
            </div>

            <div class="guide-section">
                <h3>‚öîÔ∏è Player Spells</h3>
                <p style="color: #4ECDC4; font-style: italic; margin-bottom: 15px;">üí° Desktop: Press Q/W/E keys | Mobile: Touch the spell icons!</p>
                <div class="spell-grid">
                    <div class="spell-item player-spell">
                        <strong>Q - Dragon Cry:</strong> Move anywhere on screen + 5% crit chance (1 min cooldown)
                    </div>
                    <div class="spell-item player-spell">
                        <strong>W - Zandalari:</strong> +20% points, slow projectiles and items (45s cooldown)
                    </div>
                    <div class="spell-item player-spell">
                        <strong>E - Flask of Titans:</strong> Remove one missed Dragonstalker (2 min cooldown)
                    </div>
                </div>
            </div>

            <div class="guide-section">
                <h3>üíÄ Dangerous Projectiles (Avoid These!)</h3>
                <div class="spell-grid">
                    <div class="spell-item dangerous">
                        <strong>Fireball</strong> - 8 HP damage
                    </div>
                    <div class="spell-item dangerous">
                        <strong>Frostbolt</strong> - 15 HP damage
                    </div>
                    <div class="spell-item dangerous">
                        <strong>Shadowbolt</strong> - 10 HP damage over 5 seconds
                    </div>
                </div>
            </div>

            <div class="guide-section">
                <h3>üíé Item Types & Points</h3>
                <div class="item-grid">
                    <div class="item-type">
                        <strong>üëë Zee Zgnan:</strong> 15 points (Ultra Rare)
                    </div>
                    <div class="item-type">
                        <strong>‚ö° Legendary:</strong> Thunder Fury - 5 points + Auto-collect all items
                    </div>
                    <div class="item-type">
                        <strong>üõ°Ô∏è Tier Set:</strong> Dragonstalker pieces - 6 points each (Must collect all 10!)
                    </div>
                    <div class="item-type">
                        <strong>‚òÖ Special:</strong> 4-7 points (Rare items)
                    </div>
                    <div class="item-type">
                        <strong>‚óÜ Epic:</strong> 5-10 points (Uncommon items)
                    </div>
                    <div class="item-type">
                        <strong>‚óã Regular:</strong> 1-4 points (Common items)
                    </div>
                </div>
            </div>

            <div class="guide-section">
                <h3>üí• Critical Hit System</h3>
                <p>‚Ä¢ 10% base chance to double points from any item</p>
                <p>‚Ä¢ Complete Dragonstalker sets: +5% crit chance each</p>
                <p>‚Ä¢ Collect Thunder Fury: +1% crit chance each</p>
                <p>‚Ä¢ Maximum crit chance: 25%</p>
            </div>

            <div class="guide-section">
                <h3>üí® Dodge Rating System</h3>
                <p>‚Ä¢ 10% base chance to avoid damage from projectiles and item misses</p>
                <p>‚Ä¢ Complete Dragonstalker sets: +1% dodge chance each</p>
                <p>‚Ä¢ Zandalari spell: +5% dodge chance for 15s after spell expires</p>
                <p>‚Ä¢ Aspect of the Monkey power-up: +3% dodge chance for 15 seconds</p>
                <p>‚Ä¢ Evasion power-up: +1% permanent dodge chance</p>
                <p>‚Ä¢ <strong>Area Expansion:</strong> Each HP saved from dodges expands your movable area by 1 pixel</p>
                <p>‚Ä¢ Dodge is checked BEFORE Power Word Shield</p>
                <p>‚Ä¢ Dodge does NOT prevent DOT damage ticks</p>
                <p>‚Ä¢ Maximum dodge chance: 25%</p>
            </div>

            <div class="guide-section">
                <h3>üèπ Arrow Combat System</h3>
                <p>‚Ä¢ Collect "Thorium Headed Arrows" power-ups to gain 1000 arrows</p>
                <p>‚Ä¢ <strong>Autoshot (A):</strong> Fires 1 arrow straight up (no cooldown)</p>
                <p>‚Ä¢ <strong>Multishot (R):</strong> Fires 3 arrows in spread pattern with +5% crit (10s cooldown)</p>
                <p>‚Ä¢ Arrows collect items on contact (same as player collision)</p>
                <p>‚Ä¢ Arrows destroy harmful projectiles and gain beneficial effects</p>
                <p>‚Ä¢ Multishot arrows have increased crit chance for collected items</p>
            </div>

            <div class="guide-section">
                <h3>üèÜ Scoring Tips</h3>
                <p>‚Ä¢ Use Zandalari spell for +20% points and to slow down all falling objects</p>
                <p>‚Ä¢ Collect Speed Boost projectiles to increase game speed and scoring</p>
                <p>‚Ä¢ Thunder Fury automatically collects all items on screen AND increases crit chance</p>
                <p>‚Ä¢ Complete multiple Dragonstalker sets to maximize crit chance</p>
                <p>‚Ä¢ Higher game speeds = more items = higher scores</p>
            </div>
        </div>
        <button id="backToMenuBtn2">Back to Menu</button>
    </div>

    <!-- Pause Menu Screen -->
    <div id="pauseMenu" style="display: none;">
        <div class="pause-content">
            <h2>‚è∏Ô∏è GAME PAUSED</h2>
            <p class="pause-subtitle">Game is temporarily paused</p>
            <div class="pause-buttons">
                <button id="continuePauseBtn" class="pause-btn continue-btn">
                    ‚ñ∂Ô∏è Continue
                </button>
                <button id="gameInfoPauseBtn" class="pause-btn info-btn">
                    üìñ Game Info
                </button>
                <button id="settingsPauseBtn" class="pause-btn settings-btn">
                    ‚öôÔ∏è Settings
                </button>
                <button id="restartPauseBtn" class="pause-btn restart-btn">
                    üîÑ Restart
                </button>
            </div>
            <p class="pause-hint">Press ESC to continue</p>
        </div>
    </div>

    <!-- Game Over Screen -->
    <div id="gameOver" style="display: none;">
        <h2>Game Over!</h2>
        <p id="finalScore">Final Score: 0</p>
        <p id="newHighScore" style="display: none; color: #FFD700; font-weight: bold; margin: 10px 0;">üéâ NEW HIGH SCORE! üéâ</p>
        <button id="restartBtn">Play Again</button>
        <button id="viewScoresBtn2">View High Scores</button>
    </div>


    
    <!-- DOM-based Items Collection Panel -->
    <div id="itemsCollectionPanel" class="hidden">
        <div class="panel-header">
            <div class="player-name" id="playerNameDisplay">Player: aaaa</div>
            <div class="player-score" id="playerScoreDisplay">0</div>
            <div class="player-level" id="playerLevelDisplay">Level 1</div>
            
            <!-- Compact Health Bar -->
            <div class="player-health-bar">
                <div class="player-health-background">
                    <div class="player-health-fill" id="playerHealthFill"></div>
                </div>
                <div class="player-health-text" id="playerHealthText">100/100</div>
            </div>
            
            <div class="collection-summary">
                <span id="collectionCount">0 types, 0 total</span>
            </div>
        </div>
        
        <!-- Compact Health Bar Section -->
        <div class="player-health-section">
            <div id="healthBar" class="compact-health-bar">
                <div class="player-portrait">
                    <img src="assets/efto.png" alt="Player Portrait">
                </div>
                <div class="health-bar-container">
                    <div class="health-background">
                        <div class="health-fill" id="healthFill"></div>
                    </div>
                    <div class="health-text" id="healthText">100%</div>
                </div>
            </div>
        </div>
        
        <!-- Player Stats Section -->
        <div class="player-stats">
            <div class="stat-row">
                <span class="stat-label">Speed:</span>
                <span class="stat-value" id="gameSpeed">1.0x</span>
            </div>
            <div class="stat-row" id="speedBoostRow" style="display: none;">
                <span class="stat-label">Speed Boost:</span>
                <span class="stat-value" id="speedBoostValue">+0%</span>
            </div>
            <!-- Removed Actual Item Speed and Actual Projectile Speed - not needed -->
            <div class="stat-row">
                <span class="stat-label">Crit Chance:</span>
                <span class="stat-value" id="critRating">10%</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Dodge Chance:</span>
                <span class="stat-value" id="dodgeRating">0%</span>
            </div>
            <!-- Removed Dodges Made - not needed -->
            <div class="stat-row">
                <span class="stat-label">Health Saved:</span>
                <span class="stat-value" id="healthSavedFromDodges">0 HP</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Dodge Area:</span>
                <span class="stat-value" id="dodgeAreaExpansion">+0px</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Arrows:</span>
                <span class="stat-value" id="arrowCount">0</span>
            </div>
        </div>
        
        <!-- Items List -->
        <div class="items-list" id="itemsList">
            <!-- Items will be dynamically populated here -->
        </div>
        
        <!-- Overflow indicator -->
        <div class="overflow-indicator hidden" id="overflowIndicator">
            <span id="overflowText">... +0 more items (0 pts)</span>
        </div>
    </div>
    
    <!-- Dedicated Dragonstalker Progress Panel -->
    <div id="dragonstalkerProgressPanel" class="hidden">
        <div class="dragonstalker-panel-header">
            <div class="dragonstalker-progress-bar">
                <div class="progress-background">
                    <div class="progress-fill" id="dragonstalkerProgressFill"></div>
                </div>
                <div class="progress-text" id="dragonstalkerProgressText">0/10 PIECES</div>
            </div>
            <div class="dragonstalker-status" id="dragonstalkerStatus"></div>
        </div>
        
        <div class="dragonstalker-items-list" id="dragonstalkerItemsList">
            <!-- Dragonstalker items will be populated here -->
        </div>
        
    </div>

    <!-- Game Script -->
    <script type="module" src="game-modular.js?v=1.3.0"></script>
    
    <!-- Temporary Cache Debugging Script -->
    <script>
        // Add cache debugging utilities to window for console access
        window.clearGameCacheNow = function() {
            console.log('üßπ Manually clearing all caches...');
            
            // Clear localStorage (keep high scores)
            const keysToKeep = ['dmtribut_high_scores'];
            Object.keys(localStorage).forEach(key => {
                if (!keysToKeep.includes(key)) {
                    localStorage.removeItem(key);
                    console.log('Cleared:', key);
                }
            });
            
            // Clear all caches
            if ('caches' in window) {
                caches.keys().then(cacheNames => {
                    return Promise.all(
                        cacheNames.map(cacheName => {
                            console.log('Clearing cache:', cacheName);
                            return caches.delete(cacheName);
                        })
                    );
                }).then(() => {
                    console.log('‚úÖ All caches cleared');
                    alert('Cache cleared! Please refresh the page (Ctrl+F5).');
                });
            } else {
                alert('Cache cleared! Please refresh the page (Ctrl+F5).');
            }
        };
        



        console.log('üßπ To clear cache manually, run: clearGameCacheNow()');
        console.log('üì± Chrome Force Refresh: Ctrl+Shift+R or Ctrl+F5');
    </script>
</body>
</html> 